<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<title>Info Kajian Masjid</title>

<style>

/* =====================
   DARK MOSQUE PREMIUM
===================== */

:root{
--bg:#070b11;
--card:#0e1624;
--text:#eef4ff;
--muted:#9fb0d0;

--gold:#d4af37;
--green:#1dbb86;

--border:rgba(255,255,255,.08);
--radius:18px;
--shadow:0 20px 60px rgba(0,0,0,.45);
}

*{box-sizing:border-box}

body{
margin:0;
font-family:system-ui;
color:var(--text);

background:
radial-gradient(1000px 600px at 20% -10%, rgba(212,175,55,.25), transparent),
radial-gradient(800px 500px at 100% 0%, rgba(29,187,134,.15), transparent),
var(--bg);
}

.container{
max-width:1150px;
margin:auto;
padding:24px;
}

/* HEADER */

header{
display:flex;
justify-content:space-between;
align-items:flex-start;
gap:16px;
margin-bottom:14px;
}

.brand h1{
margin:0;
font-size:28px;
}

.brand p{
margin:4px 0 0;
color:var(--muted);
}

.badge{
padding:10px 14px;
border-radius:999px;
border:1px solid var(--border);
background:rgba(255,255,255,.05);
font-size:13px;
}

/* PANELS */

.grid{
display:grid;
grid-template-columns:1.2fr .8fr;
gap:18px;
}

@media(max-width:900px){
.grid{grid-template-columns:1fr}
}

.panel{
background:var(--card);
border:1px solid var(--border);
border-radius:var(--radius);
padding:16px;
box-shadow:var(--shadow);
}

/* FILTER */

.filters{
display:grid;
grid-template-columns:1fr 1fr;
gap:10px;
}

@media(max-width:500px){
.filters{grid-template-columns:1fr}
}

label{
font-size:12px;
color:var(--muted);
display:flex;
flex-direction:column;
gap:6px;
}

input,select{
padding:10px;
border-radius:10px;
border:1px solid var(--border);
background:#0a1220;
color:white;
}

.btn{
padding:10px 12px;
border-radius:12px;
border:1px solid var(--border);
background:rgba(255,255,255,.05);
cursor:pointer;
font-weight:700;
}

.btn.primary{
background:linear-gradient(135deg,var(--gold),#b89628);
color:#000;
border:none;
}

.btn.good{
background:linear-gradient(135deg,var(--green),#128a65);
border:none;
}

/* CARDS */

.cards{
margin-top:18px;
display:grid;
gap:12px;
}

.card{
display:flex;
gap:14px;
background:#0b1322;
border:1px solid var(--border);
border-radius:var(--radius);
padding:14px;
}

.datebox{
min-width:90px;
text-align:center;
border-radius:14px;
border:1px solid var(--border);
padding:10px;
background:rgba(255,255,255,.04);
}

.day{
font-size:12px;
color:var(--gold);
font-weight:800;
}

.d{
font-size:22px;
font-weight:900;
}

.m,.t{
font-size:12px;
color:var(--muted);
}

.meta{
display:flex;
flex-wrap:wrap;
gap:6px;
margin:6px 0;
}

.pill{
padding:5px 8px;
border-radius:999px;
border:1px solid var(--border);
font-size:12px;
}

footer{
margin-top:18px;
color:var(--muted);
font-size:13px;
display:flex;
justify-content:space-between;
}

.empty{
padding:20px;
border:1px dashed var(--border);
border-radius:var(--radius);
text-align:center;
color:var(--muted);
}

</style>
</head>

<body>
<div class="container">

<header>
<div class="brand">
<h1>ðŸ•Œ Info Kajian Masjid</h1>
<p>Cari jadwal kajian dengan cepat & akurat.</p>
</div>

<div class="badge">LIVE Google Sheet</div>
</header>

<div class="grid">

<section class="panel">

<h3>Filter</h3>

<div class="filters">
<label>Kata kunci<input id="q"/></label>
<label>Lokasi<input id="lokasi"/></label>

<label>Ustadz
<select id="ustadz"><option value="">Semua</option></select>
</label>

<label>Mode
<select id="mode">
<option value="">Semua</option>
<option value="offline">Offline</option>
<option value="online">Online</option>
</select>
</label>

<label>Hari
<select id="hari">
<option value="">Semua</option>
<option>Senin</option>
<option>Selasa</option>
<option>Rabu</option>
<option>Kamis</option>
<option>Jumat</option>
<option>Sabtu</option>
<option>Ahad</option>
</select>
</label>

<label>Dari<input type="date" id="from"/></label>
<label>Sampai<input type="date" id="to"/></label>
</div>

<br>

<button class="btn primary" id="apply">Terapkan</button>
<button class="btn" id="reset">Reset</button>

<div id="count"></div>

</section>

<aside class="panel">

<h3>Kontak Admin</h3>

<a id="waAdmin" class="btn good" target="_blank">WhatsApp Admin</a>

</aside>

</div>

<section class="cards" id="cards"></section>

<footer>
<div>Â© <span id="year"></span></div>
<div id="footerCount"></div>
</footer>

</div>

<script>

/* =====================
CONFIG
===================== */

const SHEET =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT19VlHhkz0RgtPesT2GEFRSKdmYDAllI0I7qnh4F9SnkRzua9OFPmd2KFWShb8J54WyUbfHMmlJwAK/pub?gid=0&single=true&output=csv";

document.getElementById("year").textContent=new Date().getFullYear();

document.getElementById("waAdmin").href=
"https://wa.me/6282134864427";

/* =====================
UTIL
===================== */

const $=q=>document.querySelector(q);

function normalizeTime(t=""){
t=t.trim().replace(".",":");

if(!t.includes(":")) t+=":00";

let [h,m]=t.split(":").map(Number);

if(!h) h=0;
if(!m) m=0;

return String(h).padStart(2,"0")+":"+String(m).padStart(2,"0");
}

function dayName(d){
return["Ahad","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"][d];
}

function monthName(m){
return["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"][m];
}

/* =====================
SORT SUPER FIX
===================== */

function sortKajian(a,b){

const A=new Date(`${a.date}T${normalizeTime(a.time)}:00`).getTime();
const B=new Date(`${b.date}T${normalizeTime(b.time)}:00`).getTime();

return A-B;
}

/* =====================
LOAD CSV
===================== */

let data=[];

async function load(){

const res=await fetch(SHEET);
const txt=await res.text();

const rows=txt.split("\n").map(r=>r.split(","));

const headers=rows[0];

data=rows.slice(1).map(r=>({
title:r[1],
ustadz:r[2],
topic:r[3],
date:r[4],
time:r[5],
mode:(r[6]||"offline").toLowerCase(),
place:r[7],
address:r[8],
notes:r[11]
}));

hydrate();
render();

}

function hydrate(){

const s=$("#ustadz");

[...new Set(data.map(d=>d.ustadz))]
.sort()
.forEach(u=>{
const o=document.createElement("option");
o.value=u;
o.textContent=u;
s.appendChild(o);
});

}

/* =====================
FILTER
===================== */

function getFilters(){
return{
q:$("#q").value.toLowerCase(),
lokasi:$("#lokasi").value.toLowerCase(),
ustadz:$("#ustadz").value,
mode:$("#mode").value,
hari:$("#hari").value,
from:$("#from").value,
to:$("#to").value
};
}

function match(d,f){

if(f.q && !(d.title+d.topic+d.place+d.ustadz).toLowerCase().includes(f.q))
return false;

if(f.lokasi && !(d.place+d.address).toLowerCase().includes(f.lokasi))
return false;

if(f.ustadz && d.ustadz!==f.ustadz) return false;

if(f.mode && d.mode!==f.mode) return false;

if(f.hari){
const h=dayName(new Date(d.date).getDay());
if(h!==f.hari) return false;
}

if(f.from && d.date<f.from) return false;
if(f.to && d.date>f.to) return false;

return true;
}

/* =====================
RENDER
===================== */

function render(){

const f=getFilters();

const list=data
.sort(sortKajian)
.filter(d=>match(d,f));

const wrap=$("#cards");
wrap.innerHTML="";

if(!list.length){
wrap.innerHTML=`<div class="empty">Tidak ada kajian.</div>`;
return;
}

list.forEach(d=>{

const dt=new Date(d.date);

wrap.innerHTML+=`
<div class="card">

<div class="datebox">
<div class="day">${dayName(dt.getDay())}</div>
<div class="d">${dt.getDate()}</div>
<div class="m">${monthName(dt.getMonth())}</div>
<div class="t">${normalizeTime(d.time)} WIB</div>
</div>

<div>
<h3>${d.title}</h3>

<div class="meta">
<span class="pill">${d.ustadz}</span>
<span class="pill">${d.mode}</span>
<span class="pill">${d.place}</span>
</div>

<div>${d.notes||""}</div>
</div>

</div>
`;

});

$("#count").textContent=`Menampilkan ${list.length} kajian`;
$("#footerCount").textContent=list.length+" kajian";

}

$("#apply").onclick=render;
$("#reset").onclick=()=>{
document.querySelectorAll("input,select").forEach(i=>i.value="");
render();
};

load();

</script>
</body>
</html>
